# ─────────────────────────────────────────────────────────────────────────────
# application-test.properties
# ─────────────────────────────────────────────────────────────────────────────

spring.application.name=spring-boot-kafka-batch-test

# ── Spring Batch ──────────────────────────────────────────────────────────────
spring.batch.job.enabled=false
spring.batch.jdbc.initialize-schema=always

# ── H2 DataSource (test) ───────────────────────────────────────────────────────
# Use in-memory database for tests to avoid file system issues
spring.datasource.url=jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;MODE=Oracle
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=

# Disable JPA/Hibernate to avoid logging issues
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.generate_statistics=false
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.query.in_clause_parameter_padding=true

# H2 Console (disabled for tests)
spring.h2.console.enabled=false

# Simplified HikariCP for tests
spring.datasource.hikari.maximum-pool-size=5
spring.datasource.hikari.minimum-idle=1
spring.datasource.hikari.connection-timeout=10000

# ── Kafka (test) ───────────────────────────────────────────────────────────────
kafka.bootstrap-servers=192.168.1.31:9092
kafka.bootstrap.servers =192.168.1.31:9092
kafka.group-id=test-batch-processor-group
kafka.topic=test-batch-trigger-topic
kafka.dlq-topic=test-batch-trigger-dlq

# Disable Kafka auto-configuration for tests
spring.kafka.consumer.auto-offset-reset=earliest
spring.kafka.consumer.enable-auto-commit=false
spring.kafka.consumer.max-poll-records=5
spring.kafka.consumer.properties.session.timeout.ms=300000
spring.kafka.consumer.properties.max.poll.interval.ms=600000
spring.kafka.consumer.properties.heartbeat.interval.ms=10000

spring.kafka.producer.acks=all
spring.kafka.producer.retries=3
spring.kafka.producer.properties.enable.idempotence=true

# ── Batch job tuning (test) ─────────────────────────────────────────────────────
batch.job.chunk-size=100
batch.job.grid-size=2
batch.job.skip-limit=10
batch.job.retry-limit=1
batch.job.thread-pool-core-size=2
batch.job.thread-pool-max-size=4
batch.job.max-concurrent-jobs=1

# ── Logging (test) ───────────────────────────────────────────────────────────────
# Reduce Hibernate logging to avoid the JBoss logging issue
logging.level.com.ing.kallitech=INFO
logging.level.org.springframework.batch=WARN
logging.level.org.springframework.kafka=WARN
logging.level.org.hibernate=WARN
logging.level.org.hibernate.SQL=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=WARN
logging.level.org.hibernate.type.descriptor.sql.BasicExtractor=WARN
logging.level.org.springframework.orm.jpa=WARN
logging.level.org.jboss.logging=WARN
logging.pattern.console=%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n

# ── Exclude problematic auto-configurations ─────────────────────────────────────
spring.autoconfigure.exclude=\
  org.springframework.boot.autoconfigure.kafka.KafkaAutoConfiguration,\
  org.springframework.boot.autoconfigure.data.jpa.JpaRepositoriesAutoConfiguration,\
  org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration,\
  org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration
